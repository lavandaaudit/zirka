<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBONIRIUM · 3D Star Storm</title>
<style>
  body { margin: 0; overflow: hidden; background: #0a0e14; }
  #info{
    position:absolute; top:16px; left:16px; font-family: monospace;
    color:#aaffcc; font-size:12px; line-height:1.4; text-shadow:0 0 4px #000;
  }
  #info b{ color:#6fffa0; }
</style>
</head>
<body>
<div id="info">
  <div>Star activity: <b><span id="activity">–</span></b></div>
  <div>Brightness: <b><span id="brightness">–</span></b></div>
  <div>Flares: <b><span id="flares">–</span></b></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>

<script>
let scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x0a0e14, 0.02);

let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 2000);
camera.position.set(0, 50, 150);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x0a0e14);
document.body.appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.1;
controls.minDistance = 30;
controls.maxDistance = 400;

// ==================================================
// Частинки зірки
const particleCount = 8000;
let starParticles = new THREE.BufferGeometry();
let positions = new Float32Array(particleCount*3);
let basePositions = new Float32Array(particleCount*3);
let velocities = new Float32Array(particleCount*3);
let colors = new Float32Array(particleCount*3);

for(let i=0;i<particleCount;i++){
  // сфера
  let r = Math.random()*10 + 5;
  let theta = Math.random()*Math.PI*2;
  let phi = Math.random()*Math.PI;

  let x = r * Math.sin(phi) * Math.cos(theta);
  let y = r * Math.sin(phi) * Math.sin(theta);
  let z = r * Math.cos(phi);

  positions[i*3] = x;
  positions[i*3+1] = y;
  positions[i*3+2] = z;

  basePositions[i*3] = x;
  basePositions[i*3+1] = y;
  basePositions[i*3+2] = z;

  velocities[i*3] = (Math.random()-0.5)*0.05;
  velocities[i*3+1] = (Math.random()-0.5)*0.05;
  velocities[i*3+2] = (Math.random()-0.5)*0.05;

  colors[i*3] = 1.0;
  colors[i*3+1] = 0.9 + Math.random()*0.1;
  colors[i*3+2] = 0.6 + Math.random()*0.4;
}

starParticles.setAttribute('position', new THREE.BufferAttribute(positions,3));
starParticles.setAttribute('color', new THREE.BufferAttribute(colors,3));

let starMaterial = new THREE.PointsMaterial({
  size: 2.5,
  vertexColors:true,
  transparent:true,
  opacity:0.8,
  depthWrite:false,
  blending:THREE.AdditiveBlending
});

let star = new THREE.Points(starParticles, starMaterial);
scene.add(star);

// ==================================================
// Світло від зорі
let starLight = new THREE.PointLight(0xfff0aa, 1.5, 300);
scene.add(starLight);

// ==================================================
// Змінні зоряної активності
let starActivity = 0, brightness = 1, flareChance = 0;

// ==================================================
// Турбулентність частинок при фларі
function applySolarFlares(){
  for(let i=0;i<particleCount;i++){
    positions[i*3] += (basePositions[i*3]-positions[i*3])*0.02 + velocities[i*3]*0.5;
    positions[i*3+1] += (basePositions[i*3+1]-positions[i*3+1])*0.02 + velocities[i*3+1]*0.5;
    positions[i*3+2] += (basePositions[i*3+2]-positions[i*3+2])*0.02 + velocities[i*3+2]*0.5;

    if(Math.random()<flareChance*0.002){
      positions[i*3] += (Math.random()-0.5)*2;
      positions[i*3+1] += (Math.random()-0.5)*2;
      positions[i*3+2] += (Math.random()-0.5)*2;
    }
  }
}

// ==================================================
// Підключення NASA API для сонячних фларів
async function updateStarData(){
  try{
    const r = await fetch('https://api.nasa.gov/DONKI/FLR?startDate=2026-01-01&endDate=2026-01-30&api_key=DEMO_KEY');
    const data = await r.json();

    starActivity = data.length;
    flareChance = starActivity/10;
    brightness = Math.min(2,1 + starActivity*0.05);

    document.getElementById('activity').textContent = starActivity;
    document.getElementById('brightness').textContent = brightness.toFixed(2);
    document.getElementById('flares').textContent = flareChance.toFixed(2);

    starMaterial.size = 2.0 + brightness;
    starLight.intensity = brightness;
  }catch(e){ console.warn(e); }
}

updateStarData();
setInterval(updateStarData,10*60*1000);

// ==================================================
function animate(){
  requestAnimationFrame(animate);
  const t = Date.now()*0.001;

  // "Дихання" зірки
  for(let i=0;i<particleCount;i++){
    positions[i*3] += Math.sin(t+i*0.1)*0.01;
    positions[i*3+1] += Math.cos(t+i*0.1)*0.01;
    positions[i*3+2] += Math.sin(t+i*0.1)*0.01;
  }

  applySolarFlares();

  starParticles.attributes.position.needsUpdate = true;

  controls.update();
  renderer.render(scene,camera);
}
animate();

// ==================================================
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
