<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBONIRIUM · 3D Star Dynamics</title>
<style>
  body { margin: 0; overflow: hidden; background: #0a0e14; }
  #info{
    position:absolute; top:16px; left:16px; font-family: monospace;
    color:#aaffcc; font-size:12px; line-height:1.4; text-shadow:0 0 4px #000;
  }
  #info b{ color:#6fffa0; }
</style>
</head>
<body>
<div id="info">
  <div>Temperature: <b><span id="temp">–</span> °C</b></div>
  <div>Wind speed: <b><span id="wind">–</span> m/s</b></div>
  <div>Humidity: <b><span id="hum">–</span>%</b></div>
  <div>Pressure: <b><span id="press">–</span> hPa</b></div>
  <div>Solar radiation: <b><span id="solar">–</span></b></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>

<script>
let scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x0a0e14, 0.02);

let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 2000);
camera.position.set(0, 50, 150);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x0a0e14);
document.body.appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.1;
controls.minDistance = 50;
controls.maxDistance = 400;

// ==================================================
// Частинки-зірка
const particleCount = 8000;
let starGeometry = new THREE.BufferGeometry();
let positions = new Float32Array(particleCount*3);
let velocities = new Float32Array(particleCount*3);
let colors = new Float32Array(particleCount*3);

for(let i=0;i<particleCount;i++){
  // формуємо сферичну зірку
  const radius = 20 + Math.random()*10;
  const theta = Math.random()*Math.PI*2;
  const phi = Math.acos((Math.random()*2)-1);
  positions[i*3] = radius*Math.sin(phi)*Math.cos(theta);
  positions[i*3+1] = radius*Math.sin(phi)*Math.sin(theta);
  positions[i*3+2] = radius*Math.cos(phi);

  velocities[i*3] = (Math.random()-0.5)*0.02;
  velocities[i*3+1] = (Math.random()-0.5)*0.02;
  velocities[i*3+2] = (Math.random()-0.5)*0.02;

  colors[i*3] = 1.0;
  colors[i*3+1] = 0.9 + Math.random()*0.1;
  colors[i*3+2] = 0.7 + Math.random()*0.3;
}

starGeometry.setAttribute('position', new THREE.BufferAttribute(positions,3));
starGeometry.setAttribute('color', new THREE.BufferAttribute(colors,3));

let starMaterial = new THREE.PointsMaterial({
  size: 2.0,
  vertexColors:true,
  transparent:true,
  opacity:0.8,
  depthWrite:false,
  blending:THREE.AdditiveBlending
});

let star = new THREE.Points(starGeometry, starMaterial);
scene.add(star);

// ==================================================
// Світло "внутрішнє сяйво"
let glow = new THREE.PointLight(0xffee88, 1.5, 400);
scene.add(glow);

// ==================================================
// Параметри погоди / дані NOAA
let temperature=0, windSpeed=0, humidity=0, pressure=0, solar=0;

// ==================================================
// Функція для оновлення даних з NOAA
async function updateNOAA(){
  try{
    // Приклад: NOAA API для погодних станцій (заміни на власну станцію та токен)
    const stationId = 'GHCND:USW00094728'; // приклад Нью-Йорк
    const token = 'DEMO_TOKEN'; // встав свій NOAA API токен
    const response = await fetch(`https://www.ncei.noaa.gov/access/services/data/v1?dataset=daily-summaries&stations=${stationId}&startDate=2026-01-01&endDate=2026-01-30&format=json`, {
      headers: { 'token': token }
    });
    const data = await response.json();
    const d = data[data.length-1]; // беремо останній день

    temperature = d.TMAX??0;
    windSpeed = d.WIND??0;
    humidity = d.HUMIDITY??50;
    pressure = d.PRES??1013;
    solar = d.SOLAR??0;

    // Оновлення UI
    document.getElementById('temp').textContent = temperature;
    document.getElementById('wind').textContent = windSpeed.toFixed(1);
    document.getElementById('hum').textContent = humidity;
    document.getElementById('press').textContent = pressure;
    document.getElementById('solar').textContent = solar;
  }catch(e){ console.warn(e); }
}

// NOAA оновлення кожні 15 хв
updateNOAA();
setInterval(updateNOAA,15*60*1000);

// ==================================================
// Анімація зірки
function animate(){
  requestAnimationFrame(animate);
  const t = Date.now()*0.001;

  // "Дихання" зірки
  for(let i=0;i<particleCount;i++){
    positions[i*3+1] += Math.sin(t+i*0.1)*0.01;
    positions[i*3] += velocities[i*3]*(0.5 + windSpeed*0.01);
    positions[i*3+2] += velocities[i*3+2]*(0.5 + windSpeed*0.01);
  }

  // Змінюємо розмір зірки залежно від температури та сонячної активності
  const scale = 1 + temperature/50 + solar/200;
  star.scale.set(scale, scale, scale);

  // Зміна інтенсивності світла від тиску та вологості
  glow.intensity = 1 + (pressure-1013)/50 + humidity/100;

  starGeometry.attributes.position.needsUpdate=true;

  controls.update();
  renderer.render(scene,camera);
}
animate();

// ==================================================
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
