<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBONIRIUM · 3D Cosmic Space Weather Live</title>
<style>
  body { margin:0; overflow:hidden; background:#0a0e14; }
  #info{
    position:absolute; top:16px; left:16px; font-family:monospace;
    color:#aaffcc; font-size:11px; line-height:1.4; text-shadow:0 0 3px #000;
    max-width:340px;
  }
  #info b{ color:#6fffa0; }
</style>
</head>
<body>

<div id="info">
  <div>Solar Wind Speed: <b><span id="wind_speed">–</span> km/s</b></div>
  <div>Solar Wind Density: <b><span id="wind_den">–</span> /cm³</b></div>
  <div>IMF Bt: <b><span id="bt">–</span> nT</b></div>
  <div>IMF Bz: <b><span id="bz">–</span> nT</b></div>
  <div>Planetary Kp: <b><span id="kp">–</span></b></div>
  <div>F10.7 Flux: <b><span id="f107">–</span> sfu</b></div>
  <div>X‑ray Flux (GOES): <b><span id="xray">–</span></b></div>
  <div>Proton Flux ≥10 MeV: <b><span id="p10">–</span></b></div>
  <div>Aurora Prob (N): <b><span id="aurora_n">–</span>%</b></div>
  <div>Aurora Prob (S): <b><span id="aurora_s">–</span>%</b></div>
  <div>Radio Scale (R): <b><span id="scaleR">–</span></b></div>
  <div>Geomag Scale (G): <b><span id="scaleG">–</span></b></div>
  <div>Solar Rad Scale (S): <b><span id="scaleS">–</span></b></div>
  <div>Last Update: <b><span id="last_update">–</span></b></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>

<script>
let scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x0a0e14, 0.028);

let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 2000);
camera.position.set(0, 80, 220);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x0a0e14);
document.body.appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// 3D зірка
const count = 15000;
let geom = new THREE.BufferGeometry();
let pos = new Float32Array(count*3);
let col = new Float32Array(count*3);
for(let i=0; i<count; i++){
  const r = 40 + Math.random()*20;
  const theta = Math.random()*Math.PI*2;
  const phi = Math.acos(2*Math.random()-1);
  pos[3*i]   = r*Math.sin(phi)*Math.cos(theta);
  pos[3*i+1] = r*Math.sin(phi)*Math.sin(theta);
  pos[3*i+2] = r*Math.cos(phi);
  col[3*i]   = 0.8 + Math.random()*0.2;
  col[3*i+1] = 0.3 + Math.random()*0.4;
  col[3*i+2] = 0.9 + Math.random()*0.1;
}
geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
geom.setAttribute('color', new THREE.BufferAttribute(col,3));

let mat = new THREE.PointsMaterial({
  size:2.2, vertexColors:true,
  transparent:true, opacity:0.9,
  blending:THREE.AdditiveBlending,
  depthWrite:false
});
let star = new THREE.Points(geom, mat);
scene.add(star);

let glow = new THREE.PointLight(0xffddaa,1.0,500);
scene.add(glow);

// Space weather data
let spaceData = {
  wind_speed:0, wind_den:0, bt:0, bz:0, kp:0,
  f107:0, xray:0, p10:0, aurora_n:0, aurora_s:0,
  scaleR:'–', scaleG:'–', scaleS:'–', last_update:'–'
};

async function fetchSpaceWeather(){
  try{
    const wind = await fetch('https://services.swpc.noaa.gov/json/rtsw/rtsw_wind_1m.json');
    const windJson = await wind.json();
    const mag  = await fetch('https://services.swpc.noaa.gov/json/rtsw/rtsw_mag_1m.json');
    const magJson = await mag.json();
    const kpJson = await fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json').then(r=>r.json());
    const f107Json = await fetch('https://services.swpc.noaa.gov/json/f107_cm_flux.json').then(r=>r.json());
    const xrayJson = await fetch('https://services.swpc.noaa.gov/json/goes/primary/xrays-1-day.json').then(r=>r.json());
    const pfluxJson= await fetch('https://services.swpc.noaa.gov/json/goes/primary/particles-1-day.json').then(r=>r.json());
    const ovation = await fetch('https://services.swpc.noaa.gov/json/ovation_aurora_latest.json').then(r=>r.json());
    const scales = await fetch('https://services.swpc.noaa.gov/products/noaa-scales.json').then(r=>r.json());

    const w = windJson[windJson.length-1]||windJson[0];
    spaceData.wind_speed = w.speed || spaceData.wind_speed;
    spaceData.wind_den   = w.density|| spaceData.wind_den;

    const m = magJson[magJson.length-1]||magJson[0];
    spaceData.bt = m.Bt||spaceData.bt;
    spaceData.bz = m.Bz||spaceData.bz;

    const k = kpJson[kpJson.length-1]||kpJson[0];
    spaceData.kp = k.kp||spaceData.kp;

    const f = f107Json[f107Json.length-1]||f107Json[0];
    spaceData.f107 = f.f107||spaceData.f107;

    const xr = xrayJson[xrayJson.length-1]||xrayJson[0];
    spaceData.xray = xr.flux||spaceData.xray;

    const p  = pfluxJson[pfluxJson.length-1]||pfluxJson[0];
    spaceData.p10 = p.protons_10_mev||spaceData.p10;

    spaceData.aurora_n = ovation.probability_northern|| spaceData.aurora_n;
    spaceData.aurora_s = ovation.probability_southern|| spaceData.aurora_s;

    const sKeys = Object.keys(scales);
    const latestScales = scales[sKeys[sKeys.length-1]];
    spaceData.scaleR = latestScales.R?.Scale||spaceData.scaleR;
    spaceData.scaleG = latestScales.G?.Scale||spaceData.scaleG;
    spaceData.scaleS = latestScales.S?.Scale||spaceData.scaleS;

    spaceData.last_update = new Date().toISOString().split('T')[1].split('.')[0];

    for(let k in spaceData){
      if(document.getElementById(k)) document.getElementById(k).textContent = spaceData[k];
    }
  }catch(e){ console.warn("SW fetch error:",e); }
}
fetchSpaceWeather();
setInterval(fetchSpaceWeather, 120000);

function animate(){
  requestAnimationFrame(animate);
  const t = Date.now()*0.001;
  let arr = geom.attributes.position.array;
  for(let i=0; i<count; i++){
    arr[3*i]   += Math.sin(t + i*0.01) * 0.01 * (1 + spaceData.wind_speed/600);
    arr[3*i+1] += Math.cos(t + i*0.02) * 0.008;
  }
  geom.attributes.position.needsUpdate=true;

  const scale = 1 + spaceData.kp/10 + Math.min(spaceData.f107/300,1);
  star.scale.set(scale, scale, scale);

  glow.intensity = 0.7 + spaceData.kp/10;

  controls.update();
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize', ()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>

</body>
</html>
